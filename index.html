<!DOCTYPE HTML>
<!--
	Prologue by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Flushy</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="icon" type="image/x-icon" href="/images/Flushy-Logo-Favicon.png">
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
		<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
		<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
		<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
		<style>

		</style>
	</head>
	<body class="is-preload">

		<!-- Header -->
			<div id="header">

				<div class="top">

					<!-- Logo -->
						<div id="logo">
							<span class="image avatar48"><img src="images/Flushy-Logo-3.png" alt="" /></span>
							<h1 id="title">Flushy</h1>
							<p>Bathroom Review Website</p>
						</div>

					<!-- Nav -->
						<nav id="nav">
							<ul>
								<li><a href="#top" id="top-link"><span class="icon solid fa-home">Finder</span></a></li>
								<li><a href="#portfolio" id="portfolio-link"><span class="icon solid fa-th">Nearby Bathrooms</span></a></li>
								<li><a href="#about" id="about-link"><span class="icon solid fa-user">Reviews</span></a></li>
								<li><a href="#contact" id="contact-link"><span class="icon solid fa-envelope">Write a Review</span></a></li>
							</ul>
						</nav>

				</div>

				<div class="bottom">

					<!-- Social Icons -->
						<ul class="icons">
							<li><a href="https://github.com/le11evan/Flushy_Website" class="icon brands fa-github" target="_blank" rel="noopener noreferrer"><span class="label">Github</span></a></li>
						</ul>

				</div>

			</div>

		<!-- Main -->
			<div id="main">

				<!-- Intro -->
					<section id="top" class="one dark cover">
						<div class="container">

							<header>
								<h2 class="alt">The #1 Bathroom Review Website, <strong>Flushy</strong></a></h2>
								<p>Leave reviews, find directions, and stay updated with various bathrooms across the world!</p>
							</header>
							
							<div>
								<a href="#portfolio" class="button scrolly">Open Bathroom Mapper</a>
							</div>
							<footer>
								<button class="button login">Login</button>
								<button class="button create-acc">Create New Account</button>
							</footer>


						</div>
					</section>

				<!-- Portfolio -->
					<section id="portfolio" class="two">
						<div class="container">

							<header>
								<h2>Nearby Bathrooms</h2>
							</header>

							<p>For now, Click "Create a review here", and input bathroom info, reviews, pictures on "Reviews" Page</p>
							<div id="map"></div>


						</div>
					</section>

				<!-- About Me -->
					<section id="about" class="three">
						<div class="container">

							<header>
								<h2>Bathroom Reviews</h2>
							</header>
							Previous restroom reviews from places near you.
							<div class="row">
								<div class="col-4 col-12-mobile">
									<article class="item">
										<a href="#" class="image fit"><img src="images/Dummy Data/Bobbys-Lux.jpg" alt="" /></a>
										<header>
											<h3>Bobby's Luxury Dining</h3>
										</header>
									</article>
									<article class="item">
										<a href="#" class="image fit"><img src="images/Dummy Data/Dell-Taco.jpg" alt="" /></a>
										<header>
											<h3>Dell Taco</h3>
										</header>
									</article>
								</div>
								<div class="col-4 col-12-mobile">
									<article class="item">
										<a href="#" class="image fit"><img src="images/Dummy Data/Lucky-Diamond-Hotel.jpg" alt="" /></a>
										<header>
											<h3>Lucky Diamond Hotel</h3>
										</header>
									</article>
									<article class="item">
										<a href="#" class="image fit"><img src="images/Dummy Data/Huntington-Beach.jpg" alt="" /></a>
										<header>
											<h3>Huntington Beach</h3>
										</header>
									</article>
								</div>
								<div class="col-4 col-12-mobile">
									<article class="item">
										<a href="#" class="image fit"><img src="images/Dummy Data/McDonalds.jpg" alt="" /></a>
										<header>
											<h3>McDonalds</h3>
										</header>
									</article>
									<article class="item">
										<a href="#" class="image fit"><img src="images/Dummy Data/AMPM.jpg" alt="" /></a>
										<header>
											<h3>AM PM Gas Station</h3>
										</header>
									</article>
								</div>
							</div>

							<!-- Image Testing -->

							<div class="row">
                                <div class="col-4 col-12-mobile">

								</div>
								<div class="col-4 col-12-mobile">
									<p> </p>
									<article class="item">
										<a href="#" id="defaultImage" class="image fit"><img src="" alt="" /></a>
										<a href="#" id="userImage1" class="image fit"><img src="" alt="" /></a>
										<header>
											<h3>Latest User Image</h3>
										</header>
									</article>

									<!-- IMAGE URLs -->
									<form action="#" method="post" id="alphaURL">
										<article class="item">
											<a href="#" class="image fit"><img src="" alt="" /></a>

											<div class="col-6 col-12-mobile">
												<input type="text" name="Image Link" placeholder="Image link" />
											</div>
										</article>
										<div class="col-6 col-12-mobile">
											<input type="button" name="refresh" value="Refresh Images" id="freshButton" />
										</div>
									</form>

									<!-- IMAGE FILEs -->
									<form method="post" id="alphaImage" enctype="multipart/form-data">
										<!-- Storage -->
										<p> </p>
										<div class="col-6 col-12-mobile">
											<input type="file" id="cloudImage" name="cloudImage" accept=".jpg, .jpeg, .png, .txt" />
                                            <p id="output"> </p>
										</div>
										<div class="col-6 col-12-mobile">
											<input type="submit" name="Storage Test" value="Storage Test" id="storageTestButton" />
										</div>
										<div class="col-4 col-12-mobile" id="cloudImgPreview">
											<p> No files currently selected for upload </p>
										</div>
									</form>
								</div>
							</div>
							<!--End Image Testing-->

						</div>
					</section>

				<!-- Contact -->
					<section id="contact" class="four">
						<div class="container">

							<header>
								<h2>Write a Review</h2>
							</header>

							<p>Review the public restrooms you have visited and let the public see your opinions. Was the restroom safe?
								Was it clean? It's up for you to decide!
							</p>

					<!-- id="userURL" onsubmit="addImageURL(userURL)" -->

					<form method="post" action="#" id="userURL">
						<div class="row">
							<!--
							<div class="col-6 col-12-mobile"><input type="text" name="name" placeholder="User" /></div>
							<div class="col-6 col-12-mobile"><input type="text" name="email" placeholder="Rating" /></div>
							-->
							<div class="col-12">
								<textarea name="url" placeholder="URL"></textarea>
							</div>
							<div class="col-12">
								<input type="button" name="submit" value="Post Image URL" id="submitButton" />
								<p id="submitTest"></p>
							</div>

						</div>
					</form>

						</div>
					</section>

			</div>

		<!-- Footer -->
			<div id="footer">

				<!-- Copyright -->
					<ul class="copyright">
						<li>&copy; Flushy. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>

			</div>

		<!-- Scripts -->

		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.scrolly.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>
		<script src="assets/js/leaflet.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

		<!-- Google Firebase (Images) (Placeholder) -->

		<script type="module">
			import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js'
			import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.7/firebase-analytics.js";
            import { getFirestore, collection, query, where, addDoc, doc, getDocs } from 'https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore.js'
            import { getStorage, ref, uploadBytesResumable} from "https://www.gstatic.com/firebasejs/9.6.7/firebase-storage.js" 

			const firebaseConfig = {
				apiKey: "AIzaSyCw0xg3NVs6qoS6RYr64er6Em9MG-DTy7c",
				authDomain: "flushy-website.firebaseapp.com",
				projectId: "flushy-website",
				storageBucket: "flushy-website.appspot.com",
				messagingSenderId: "604068868575",
				appId: "1:604068868575:web:f9f66bce716a8a6970d46a",
				measurementId: "G-BQ3XH5KJBK"
			};

			const app = initializeApp(firebaseConfig);
			const analysisData = getAnalytics(app)
			const db = getFirestore(app);

			const storage = getStorage(app);
			const output = document.querySelector("fileOutput");

			/* ========== Google Firestore Implementation ========== */

            /*
			async function getImagesAlpha(db) {
			const imageCol = collection(db, 'images-alpha');
			const imageSnapshot = await getDocs(imageCol);
			const imageList = imageSnapshot.docs.map(doc => doc.data());
			return imageList;
			}
			*/

			// --Loading Dynamic Images--
			var dImg = document.createElement('img');
            dImg.src = "images/pic07.jpg"
			document.getElementById("defaultImage").appendChild(dImg);
			// --End Loading--
			

			document.getElementById("submitButton").addEventListener("click", getForm);
			document.getElementById("freshButton").addEventListener("click", refreshImages);

			// Storage
			document.getElementById("storageTestButton").addEventListener("click", addImage);

			const cloudImage = document.getElementById("cloudImage");
			cloudImage.addEventListener("change", updateImageSelector);

			function bruh() {
				console.log("Bruh.");
			}

			// -Gets text in the "URL" form and passes it to Google Firestore-
			function getForm() {
				var formText = document.getElementById("userURL").elements[0].value;
				//document.getElementById("submitTest").innerHTML = formText;

				addImageURL(formText);
			}

			// TODO: Separate firebase call into its own async function
			async function refreshImages() {
				var formText = document.getElementById("alphaURL").elements[0].value;
				document.getElementById('defaultImage').removeChild(dImg);
				dImg.src = formText;
                document.getElementById('defaultImage').appendChild(dImg);

				/*
				// TODO: Replace with try/catch
				const querySnapshot = await getDoc(collection(db, "users", ));
                querySnapshot.forEach((doc) => {
                    console.log(`${doc.id} => ${doc.get("born")}`);
                });
				*/
				//

			}

			// - Contacts Google Firestore and attempts to store "text" as a field in the 'images-alpha' database
            async function addImageURL(text) {

                try {
                    const docRef = await addDoc(collection(db, "images-alpha"), { link: text });
                    console.log("Document written with ID: ", docRef.id);
                } catch (e) {
                    console.error("Error adding document: ", e);
                }
			}

			/* ========== End Firestore Implementation ========== */


			/* ========== Google Storage Implementation ========== */

			async function updateImageSelector() {
				const preview = document.getElementById("cloudImgPreview");

				while (preview.firstChild) {
					preview.removeChild(preview.firstChild);
				}

				const curFiles = cloudImage.files;
				if (curFiles.length === 0) {
					const para = document.createElement('p');
					para.textContent = 'No files currently selected for upload';
					preview.appendChild(para);
				} else {
					const list = document.createElement('ol');
					preview.appendChild(list);

					for (const file of curFiles) {
						const listItem = document.createElement('li');
						const para = document.createElement('p');

                        para.textContent = `File name ${file.name}, file size ${file.size}.`;
                        const image = document.createElement('img');
                        image.src = URL.createObjectURL(file);

                        listItem.appendChild(image);
						listItem.appendChild(para);

						list.appendChild(listItem);

                        //await addImage(file);
					}
				}
            }

			async function addImage(uplImg) {

                const storageRef = ref(storage, 'images/' + uplImg.name);
                const metadata = { contentType: 'image/jpeg' };

				console.log(uplImg.name);

				const uploadTask = uploadBytesResumable(storage, uplImg, metadata);

                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        console.log('Upload is ' + progress + '% done');
                        switch (snapshot.state) {
                            case 'paused':
                                console.log('Upload is paused');
                                break;
                            case 'running':
                                console.log('Upload is running');
                                break;
                        }
                    },
                    (error) => {
                        // A full list of error codes is available at
                        // https://firebase.google.com/docs/storage/web/handle-errors
                        switch (error.code) {
                            case 'storage/unauthorized':
                                // User doesn't have permission to access the object
                                break;
                            case 'storage/canceled':
                                // User canceled the upload
                                break;

                            // ...

                            case 'storage/unknown':
                                // Unknown error occurred, inspect error.serverResponse
                                break;
                        }
                    },
                    () => {
                        // Upload completed successfully, now we can get the download URL

						/*
                        getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                            console.log('File available at', downloadURL);
                        });
						*/
						console.log('File Available.')
                    }
                );
			}


			/* ========== End Google Storage ========== */
			

			/* ========== map ========================*/
			navigator.geolocation.getCurrentPosition(successCallback);  
	
			function successCallback(position){  
				var lat = position.coords.latitude;  
				var long = position.coords.longitude;  
					lat = 33.883319144135996;
					long =-117.88519218058632;

				var map=L.map('map').setView([lat,long],15);

				var LeafIcon = L.Icon.extend({
				options: {
					shadowUrl: 'images/Flushy-Marker-Shadow.png',
					iconSize:     [48, 50],
					shadowSize:   [45, 60],
					iconAnchor:   [22, 94],
					shadowAnchor: [23, 100],
					popupAnchor:  [-10, -85]
				}
				});

				var flushyIcon = new LeafIcon({iconUrl: 'images/Flushy-Marker.png'});

				L.icon = function (options) {
				return new L.Icon(options);
				};

				var marker = L.marker([lat, long], {icon: flushyIcon}).addTo(map)
				.bindPopup('You Are Here. <nav id="nav"><ul><a href="#about" id="about-link">Create a review here.</span></a></ul></nav>')
				.openPopup();; // current position
					
				//pseudocode //add maker for all nearbybathroom
				var nearbathroom = naerby(lat,long, map);
					
				L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=73G3DfyKZkKf9Tzah1qH', 
				{attributes:'<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',}).addTo(map);

				
				window.googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
						maxZoom: 20,
						subdomains:['mt0','mt1','mt2','mt3']
				});
				window.googleStreets.addTo(map);

				window.googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
				maxZoom: 20,
				subdomains:['mt0','mt1','mt2','mt3']
				});
				//window.googleSat.addTo(map); if you want use googleSat
			}




			async function naerby(lat, long, map){
				const q = query(collection(db, "location"), where("latitude", ">=", lat-0.02),where("latitude", "<=", lat+0.02));
				const querySnapshot = await getDocs(q);
			  	querySnapshot.forEach((doc) => {

				let lat1 = doc.data().latitude;
				let long1 = doc.data().longitude;
				if(long1 >= (long-0.02) && long1 <= (long+0.02)){
					var marker = L.marker([lat1, long1]).addTo(map);   // nearby marker
					//console.log(lat1); 
					//console.log(long1);
					//console.log(doc.id, " => ", doc.data());	
				}
				
				});
			}


			/* ==========  end  map ========================*/


		</script>

		



	</body>
	
</html>
